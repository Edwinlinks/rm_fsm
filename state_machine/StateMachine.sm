
%start StateMachineMap::Idle
%class StateMachine
%header rm_fsm/StateMachine.h

%map StateMachineMap
%%

// Syntax:
//
// State {
//  TransitionEvent
//      [guard]
//      NextState
//      {Action}
// }

Idle
{
    dbusUpdate(data_dbus_: rm_msgs::DbusData)
        [ ctxt.isCalibrate(data_dbus_) == true ]
        Calibrate
        {
            initCalibrate();
        }
    dbusUpdate(data_dbus_: rm_msgs::DbusData)
        [ ctxt.isRaw(data_dbus_) == true ]
        Raw
        {
            initRaw();
        }
    dbusUpdate(data_dbus_: rm_msgs::DbusData)
        nil {}
}

Raw
    Entry {
            rawChassis();
            rawGimbal();
            rawShooter();
    }
{
    dbusUpdate(data_dbus_: rm_msgs::DbusData)
        [ ctxt.isCalibrate(data_dbus_) == true ]
        Calibrate
        {
            initCalibrate();
        }
    dbusUpdate(data_dbus_: rm_msgs::DbusData)
        nil {}
}

Calibrate
    Entry {
        run();
    }
{
    refereeUpdate(referee_: rm_referee::Referee)
        [ ctxt.isStandby(referee_) == true ]
        Standby
        {
            initStandby();
        }
    refereeUpdate(referee_: rm_referee::Referee)
        [ ctxt.isCruise(referee_) == true ]
        Cruise
        {
            initCruise();
        }

    dbusUpdate(data_dbus_: rm_msgs::DbusData)
        [ ctxt.isRaw(data_dbus_) == true ]
        Raw
        {
            initRaw();
        }
    dbusUpdate(data_dbus_: rm_msgs::DbusData)
        nil {}
    refereeUpdate(referee_: rm_referee::Referee)
        nil {}
}

Standby
    Entry {
            standbyChassis();
            standbyGimbal();
            standbyShooter();
    }
{
    refereeUpdate(referee_: rm_referee::Referee)
        [ ctxt.isCruise(referee_) == true ]
        Cruise
        {
            initCruise();
        }
    dbusUpdate(data_dbus_: rm_msgs::DbusData)
        [ ctxt.isRaw(data_dbus_) == true ]
        Raw
        {
            initRaw();
        }
    dbusUpdate(data_dbus_: rm_msgs::DbusData)
        nil {}
    refereeUpdate(referee_: rm_referee::Referee)
        nil {}
}

Cruise
    Entry {
            cruiseChassis();
            cruiseShooter();
            cruiseGimbal();
    }
{
    refereeUpdate(referee_: rm_referee::Referee)
        [ ctxt.isStandby(referee_) == true ]
        Standby
        {
            initStandby();
        }
    dbusUpdate(data_dbus_: rm_msgs::DbusData)
        [ ctxt.isRaw(data_dbus_) == true ]
        Raw
        {
            initRaw();
        }
    dbusUpdate(data_dbus_: rm_msgs::DbusData)
        nil {}
    refereeUpdate(referee_: rm_referee::Referee)
        nil {}
}

Default
{
}

%%